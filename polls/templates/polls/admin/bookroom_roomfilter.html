<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
{% load static %}
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administrator</title>

    {% include './include/link_lib.html' %}
</head>
<body>
    <div id="wrapper">
        {% include "./include/nav_horizontal.html" %}
        {% include "./include/nav_vertical.html" %}

        <div id="page-wrapper">
            <div id="page-inner">
                <div class="row">
                    <div class="col-md-12">
                        <h1 class="page-header">
                            Room Booking <small>Filter room </small>
                        </h1>
                    </div>
                </div>
                <!-- /. ROW  -->

                <div style="display: flex; justify-content: space-between;">
                    <p style="display: none" id="idRequest">{{ idRequest }}</p>
                    <p>Choose <span id="number">{{ numberRoom }}</span> room(s) for this request</p>
                    <form action="/hihotel/admin/bookroom/bookfilter/" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="idRequest" value='{{ idRequest }}'>
                        <button type="button" style="float: right; margin: 20px;" class="btn btn-primary" id="buttonBooking">Booking</button>
                    </form>
                </div>
				<div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <table id="table" class="table table-striped table-bordered" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Kind</th>
                                            <th>Floor</th>
                                            <th>Name</th>
                                            <th>Status</th>
                                            <th width="10%">Choose</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for room in list_room %}
                                        <tr>
                                            <td>{{ room.idRoom }}</td>
                                            <td>{{ room.kind.nameKind }}</td>
                                            <td>{{ room.floor.nameFloor }}</td>
                                            <td>{{ room.nameRoom }}</td>
                                            <td>{{ room.status }}</td>
                                            <td>
                                                <a class="choose btn btn-primary" id="{{ room.idRoom }}">
                                                    <i class="fas fa-check"></i>
                                                </a>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /. WRAPPER  -->

    <!-- JS Scripts-->
    <!-- Metis Menu Js -->
    <script src="{% static 'polls/admin/assets/js/jquery.metisMenu.js' %}"></script>
    <!-- Morris Chart Js -->
    <script src="{% static 'polls/admin/assets/js/morris/raphael-2.1.0.min.js' %}"></script>

    <!-- Custom Js -->
    <script src="{% static 'polls/admin/assets/js/custom-scripts.js' %}"></script>

    <!-- Data table -->
    <script>
        $('.choose').click(function () {
            if ($(this).attr('class').indexOf('btn-primary') != -1) {
                if (Number($('#number').html()) == 0) {
                    alert("You can't choose any more!")
                } else {
                    $('#number').text(Number($('#number').html()) - 1)
                    $(this).removeClass('btn-primary').addClass('btn-danger')
                }
            } else {
                $('#number').text(Number($('#number').html()) + 1)
                $(this).removeClass('btn-danger').addClass('btn-primary')
            }
        });

        $('#buttonBooking').click(function() {
            var list = $('.choose')
            var res = [], n = 0
            var idRequest = $('#idRequest').html()

            for (var i = 0; i < list.length; i++) {
                if ($(list[i]).attr('class').indexOf('btn-danger') != -1) {
                    res[n] = $(list[i]).attr('id')
                    n++;
                }
            }

            if (Number($('#number').html()) == 0) {
                $(this).before("<input type='hidden' name='number' value='" + n + "'>")

                for (var i = 0; i < res.length; i++) {
                    $(this).before("<input type='hidden' name='room" + i + "' value='" + res[i] + "'>")
                }

                $(this).attr('type', 'submit')
            } else {
                alert("Choose enough number of room in this request!")
            }
        })
    </script>

</body>
</html>